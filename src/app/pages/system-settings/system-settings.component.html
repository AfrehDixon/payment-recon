<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>System Dashboard</h1>
      <p class="last-updated" *ngIf="settings">
        Last Updated: {{ formatDate(settings.lastUpdated) }}
      </p>
    </div>
    <div class="header-actions">
      <button
        (click)="toggleEdit()"
        class="btn btn-primary"
        [disabled]="loading"
        *ngIf="!isEditing"
      >
        <i class="fas fa-edit"></i>
        Edit Settings
      </button>
      <button
        (click)="refreshAll()"
        class="btn btn-secondary"
        [disabled]="loading || loadingBalance"
      >
        <i class="fas fa-sync-alt" [class.rotating]="loading || loadingBalance"></i>
        Refresh All
      </button>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="error" class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i>
    {{ error }}
    <button class="close-btn" (click)="error = null">&times;</button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    {{ successMessage }}
    <button class="close-btn" (click)="successMessage = null">&times;</button>
  </div>

  <!-- Quick Stats Cards -->
  <div class="stats-grid" *ngIf="settings && !loading">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-content">
        <h3>Total Portfolio Value</h3>
        <div class="stat-value">
          ${{
            formatCurrency(
              settings.btcBalances.totalUsdValue +
              settings.bep20Balances.totalUsdValue +
              settings.solanaBalances.totalUsdValue +
              settings.trc20Balances.totalUsdValue
            )
          }}
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon success">
        <i class="fab fa-bitcoin"></i>
      </div>
      <div class="stat-content">
        <h3>BTC Reserve</h3>
        <div class="stat-value">
          {{ formatBtc(settings.btcBalances.totalConfirmedBalance) }}
        </div>
        <div class="stat-subvalue">
          ${{ formatCurrency(settings.btcBalances.totalUsdValue) }}
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-card">
        <div class="stat-icon info">
          <i class="fas fa-exchange-alt"></i>
        </div>
        <div class="stat-content">
          <h3>Exchange Rate</h3>
          <div class="stat-value">
            ${{ formatCurrency(settings.exchangeRate) }}
          </div>
          <div class="stat-subvalue">
            Market: ${{ formatCurrency(settings.marketPrice) }}
          </div>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon warning">
        <i class="fas fa-cog"></i>
      </div>
      <div class="stat-content">
        <h3>Active Systems</h3>
        <div class="stat-value">
          {{ getActiveSystemsCount() }}
        </div>
        <div class="stat-subvalue">
          of 4 systems
        </div>
      </div>
    </div>
  </div>

  <!-- Main Settings Grid -->
  <form [formGroup]="settingsForm" *ngIf="settings && !loading" class="settings-grid">
    
    <!-- Pricing & Limits Card -->
    <div class="setting-card">
      <div class="card-header">
        <h3>Pricing & Transaction Limits</h3>
        <div class="card-badge" [class.active]="settings.dynamicPricingEnabled">
          {{ settings.dynamicPricingEnabled ? 'Dynamic' : 'Static' }} Pricing
        </div>
      </div>
      <div class="card-content">
        <div class="form-grid">
          <div class="form-group">
            <label>Markup Rate (%)</label>
            <ng-container *ngIf="!isEditing">
              <div class="display-value">{{ settings.markupRate }}%</div>
            </ng-container>
            <div *ngIf="isEditing" class="input-group">
              <input type="number" step="0.1" formControlName="markupRate" class="form-input" />
              <div class="field-error" *ngIf="getFieldError('markupRate')">
                {{ getFieldError("markupRate") }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Transaction Fee ($)</label>
            <ng-container *ngIf="!isEditing">
              <div class="display-value">${{ settings.transactionFee }}</div>
            </ng-container>
            <div *ngIf="isEditing" class="input-group">
              <input type="number" step="0.01" formControlName="transactionFee" class="form-input" />
              <div class="field-error" *ngIf="getFieldError('transactionFee')">
                {{ getFieldError("transactionFee") }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Min Transaction Amount ($)</label>
            <ng-container *ngIf="!isEditing">
              <div class="display-value">${{ settings.minTransactionAmount }}</div>
            </ng-container>
            <div *ngIf="isEditing" class="input-group">
              <input type="number" step="1" formControlName="minTransactionAmount" class="form-input" />
              <div class="field-error" *ngIf="getFieldError('minTransactionAmount')">
                {{ getFieldError("minTransactionAmount") }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Max Transaction Amount ($)</label>
            <ng-container *ngIf="!isEditing">
              <div class="display-value">${{ settings.maxTransactionAmount }}</div>
            </ng-container>
            <div *ngIf="isEditing" class="input-group">
              <input type="number" step="1" formControlName="maxTransactionAmount" class="form-input" />
              <div class="field-error" *ngIf="getFieldError('maxTransactionAmount')">
                {{ getFieldError("maxTransactionAmount") }}
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="dynamicPricingEnabled" [disabled]="!isEditing" />
              Enable Dynamic Pricing
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Address Management Card -->
    <div class="setting-card">
      <div class="card-header">
        <h3>Address Management</h3>
      </div>
      <div class="card-content">
        <div class="form-grid">
          <div class="form-group">
            <label>Max Address Age (Hours)</label>
            <ng-container *ngIf="!isEditing">
              <div class="display-value">{{ settings.maxAddressAgeHours }} hours</div>
            </ng-container>
            <div *ngIf="isEditing" class="input-group">
              <input type="number" formControlName="maxAddressAgeHours" class="form-input" />
              <div class="field-error" *ngIf="getFieldError('maxAddressAgeHours')">
                {{ getFieldError("maxAddressAgeHours") }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Min Consolidate USD</label>
            <ng-container *ngIf="!isEditing">
              <div class="display-value">${{ settings.minConsolidateUsd }}</div>
            </ng-container>
            <div *ngIf="isEditing" class="input-group">
              <input type="number" formControlName="minConsolidateUsd" class="form-input" />
              <div class="field-error" *ngIf="getFieldError('minConsolidateUsd')">
                {{ getFieldError("minConsolidateUsd") }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Min TRX Dust Needed</label>
            <ng-container *ngIf="!isEditing">
              <div class="display-value">{{ settings.minTrxDustNeeded }} TRX</div>
            </ng-container>
            <div *ngIf="isEditing" class="input-group">
              <input type="number" formControlName="minTrxDustNeeded" class="form-input" />
              <div class="field-error" *ngIf="getFieldError('minTrxDustNeeded')">
                {{ getFieldError("minTrxDustNeeded") }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Exchange Rates Card -->
    <div class="setting-card">
      <div class="card-header">
        <h3>Exchange Rates</h3>
        <div class="card-badge">Live</div>
      </div>
      <div class="card-content">
        <div class="rates-grid">
          <div class="rate-item">
            <span class="rate-label">BTC/USD:</span>
            <span class="rate-value">${{ formatCurrency(settings.btcExchangeRate) }}</span>
          </div>
          <div class="rate-item">
            <span class="rate-label">USDT/USD:</span>
            <span class="rate-value">${{ settings.usdtExchangeRate }}</span>
          </div>
          <div class="rate-item">
            <span class="rate-label">SOL/USD:</span>
            <span class="rate-value">${{ formatCurrency(settings.solExchangeRate) }}</span>
          </div>
          <div class="rate-item">
            <span class="rate-label">GHS/USD:</span>
            <span class="rate-value">GHS {{ settings.ghsExchangeRate }}</span>
          </div>
          <div class="rate-item">
            <span class="rate-label">CAD/USD:</span>
            <span class="rate-value">${{ settings.cadExchangeRate }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- P2P Rates Card -->
    <div class="setting-card">
      <div class="card-header">
        <h3>P2P Exchange Rates</h3>
        <div class="card-badge">{{ settings.p2p.USDT_GHS_BUY.provider }}</div>
      </div>
      <div class="card-content">
        <div class="p2p-grid">
          <div class="p2p-section">
            <h4>USDT/GHS</h4>
            <div class="p2p-rate">
              <span>Buy:</span>
              <strong>GHS {{ formatCurrency(settings.p2p.USDT_GHS_BUY.price) }}</strong>
            </div>
            <div class="p2p-rate">
              <span>Sell:</span>
              <strong>GHS {{ formatCurrency(settings.p2p.USDT_GHS_SELL.price) }}</strong>
            </div>
          </div>
          
          <div class="p2p-section">
            <h4>BTC/GHS</h4>
            <div class="p2p-rate">
              <span>Buy:</span>
              <strong>GHS {{ formatCurrency(settings.p2p.BTC_GHS_BUY.price) }}</strong>
            </div>
            <div class="p2p-rate">
              <span>Sell:</span>
              <strong>GHS {{ formatCurrency(settings.p2p.BTC_GHS_SELL.price) }}</strong>
            </div>
          </div>

          <div class="p2p-section">
            <h4>CAD Pairs</h4>
            <div class="p2p-rate">
              <span>USDT/CAD Buy:</span>
              <strong>${{ settings.p2p.USDT_CAD_BUY.price }}</strong>
            </div>
            <div class="p2p-rate">
              <span>BTC/CAD Buy:</span>
              <strong>${{ formatCurrency(settings.p2p.BTC_CAD_BUY.price) }}</strong>
            </div>
          </div>
        </div>
        <div class="p2p-footer">
          <small>Updated: {{ formatDate(settings.p2p.USDT_GHS_BUY.updatedAt) }}</small>
          <small>TTL: {{ settings.p2p.USDT_GHS_BUY.ttlSec }}s</small>
        </div>
      </div>
    </div>

    <div class="setting-card">
      <h3>Features</h3>
      <div class="setting-item">
        <label>Dynamic Pricing:</label>
        <ng-container *ngIf="!isEditing">
          <span [class.enabled]="settings.dynamicPricingEnabled">
            {{ settings.dynamicPricingEnabled ? "Enabled" : "Disabled" }}
          </span>
        </ng-container>
        <div *ngIf="isEditing" class="toggle-switch">
          <input
            type="checkbox"
            id="dynamicPricing"
            formControlName="dynamicPricingEnabled"
          />
          <label for="dynamicPricing"></label>
        </div>
      </div>
      <div class="setting-item">
        <label>Last Updated:</label>
        <span>{{ formatDate(settings.lastUpdated) }}</span>
      </div>
    </div>

    <div class="setting-card">
      <h3>Market Rates</h3>
      <div class="setting-item">
        <label>Market Price:</label>
        <span>${{ formatCurrency(settings.marketPrice) }}</span>
      </div>
      <div class="setting-item">
        <label>BTC Network Fee:</label>
        <span>${{ settings.btcNetworkFee }} USD</span>
      </div>
      <div class="setting-item">
        <label>BTC Exchange Rate:</label>
        <span>${{ formatCurrency(settings.btcExchangeRate) }}</span>
      </div>
      <div class="setting-item">
        <label>USDT Exchange Rate:</label>
        <span>${{ settings.usdtExchangeRate }}</span>
      </div>
      <div class="setting-item">
        <label>SOL Exchange Rate:</label>
        <span>${{ formatCurrency(settings.solExchangeRate) }}</span>
      </div>
      <div class="setting-item">
        <label>GHS Exchange Rate:</label>
        <span>GHS {{ settings.ghsExchangeRate }}</span>
      </div>
      <div class="setting-item">
        <label>BEP Exchange Rate:</label>
        <span>${{ formatCurrency(settings.bepExchangeRate) }}</span>
      </div>
    </div>

    <!-- BTC Reserve Configuration Card -->
    <div class="setting-card">
      <h3>
        BTC Reserve Configuration
        <span
          class="status-indicator"
          [class.enabled]="settings.btcReserveConfig.enabled"
        >
          {{ settings.btcReserveConfig.enabled ? "Enabled" : "Disabled" }}
        </span>
      </h3>

      <div class="setting-item">
        <label>Status:</label>
        <ng-container *ngIf="!isEditing">
          <span [class.enabled]="settings.btcReserveConfig.enabled">
            {{ settings.btcReserveConfig.enabled ? "Enabled" : "Disabled" }}
          </span>
        </ng-container>
        <div *ngIf="isEditing" class="toggle-switch">
          <input
            type="checkbox"
            id="btcReserveEnabled"
            formControlName="btcReserveEnabled"
          />
          <label for="btcReserveEnabled"></label>
        </div>
      </div>

      <div class="setting-item">
        <label>Target Percentage:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >{{
              settings.btcReserveConfig.targetPct * 100 | number : "1.1-1"
            }}%</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="0.01"
            min="0"
            max="1"
            formControlName="btcReserveTargetPct"
            class="form-input"
            placeholder="0.15"
          />
          <small class="field-help"
            >Enter as decimal (e.g., 0.15 for 15%)</small
          >
          <div class="field-error" *ngIf="getFieldError('btcReserveTargetPct')">
            {{ getFieldError("btcReserveTargetPct") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Lower Threshold:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >{{
              settings.btcReserveConfig.lowerPct * 100 | number : "1.1-1"
            }}%</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="0.01"
            min="0"
            max="1"
            formControlName="btcReserveLowerPct"
            class="form-input"
            placeholder="0.12"
          />
          <small class="field-help"
            >Enter as decimal (e.g., 0.12 for 12%)</small
          >
          <div class="field-error" *ngIf="getFieldError('btcReserveLowerPct')">
            {{ getFieldError("btcReserveLowerPct") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Upper Threshold:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >{{
              settings.btcReserveConfig.upperPct * 100 | number : "1.1-1"
            }}%</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="0.01"
            min="0"
            max="1"
            formControlName="btcReserveUpperPct"
            class="form-input"
            placeholder="0.18"
          />
          <small class="field-help"
            >Enter as decimal (e.g., 0.18 for 18%)</small
          >
          <div class="field-error" *ngIf="getFieldError('btcReserveUpperPct')">
            {{ getFieldError("btcReserveUpperPct") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Max Daily USD:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >${{ formatCurrency(settings.btcReserveConfig.maxDailyUsd) }}</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="1000"
            min="0"
            formControlName="btcReserveMaxDailyUsd"
            class="form-input"
          />
          <div
            class="field-error"
            *ngIf="getFieldError('btcReserveMaxDailyUsd')"
          >
            {{ getFieldError("btcReserveMaxDailyUsd") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Daily USD Used:</label>
        <span
          >${{ formatCurrency(settings.btcReserveConfig.dailyUsdUsed) }}</span
        >
        <small class="read-only-note">Read-only field</small>
      </div>

      <div class="setting-item">
        <label>Max Trade USD:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >${{ formatCurrency(settings.btcReserveConfig.maxTradeUsd) }}</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="1000"
            min="0"
            formControlName="btcReserveMaxTradeUsd"
            class="form-input"
          />
          <div
            class="field-error"
            *ngIf="getFieldError('btcReserveMaxTradeUsd')"
          >
            {{ getFieldError("btcReserveMaxTradeUsd") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Min Trade USD:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >${{ formatCurrency(settings.btcReserveConfig.minTradeUsd) }}</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="100"
            min="0"
            formControlName="btcReserveMinTradeUsd"
            class="form-input"
          />
          <div
            class="field-error"
            *ngIf="getFieldError('btcReserveMinTradeUsd')"
          >
            {{ getFieldError("btcReserveMinTradeUsd") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Slippage (BPS):</label>
        <ng-container *ngIf="!isEditing">
          <span>{{ settings.btcReserveConfig.slippageBps }} BPS</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="1"
            min="0"
            max="10000"
            formControlName="btcReserveSlippageBps"
            class="form-input"
          />
          <small class="field-help">1 BPS = 0.01%</small>
          <div
            class="field-error"
            *ngIf="getFieldError('btcReserveSlippageBps')"
          >
            {{ getFieldError("btcReserveSlippageBps") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Cooldown (Seconds):</label>
        <ng-container *ngIf="!isEditing">
          <span>{{ settings.btcReserveConfig.cooldownSec }}s</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="1"
            min="0"
            formControlName="btcReserveCooldownSec"
            class="form-input"
          />
          <div
            class="field-error"
            *ngIf="getFieldError('btcReserveCooldownSec')"
          >
            {{ getFieldError("btcReserveCooldownSec") }}
          </div>
        </div>
      </div>

      <!-- Editable Address Fields -->
      <div class="setting-item">
        <label>BTC Recipient:</label>
        <ng-container *ngIf="!isEditing">
          <span class="address-field">{{
            settings.btcReserveConfig.btcRecipient || "Not set"
          }}</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="text"
            formControlName="btcRecipient"
            class="form-input address-input"
            placeholder="Bitcoin address"
          />
        </div>
      </div>

      <div class="setting-item">
        <label>BSC Recipient:</label>
        <ng-container *ngIf="!isEditing">
          <span class="address-field">{{
            settings.btcReserveConfig.bscRecipient || "Not set"
          }}</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="text"
            formControlName="bscRecipient"
            class="form-input address-input"
            placeholder="BSC address"
          />
        </div>
      </div>

      <div class="setting-item">
        <label>BSC Router Address:</label>
        <ng-container *ngIf="!isEditing">
          <span class="address-field">{{
            settings.btcReserveConfig.bscRouterAddr || "Not set"
          }}</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="text"
            formControlName="bscRouterAddr"
            class="form-input address-input"
            placeholder="BSC router address"
          />
        </div>
      </div>

      <div class="setting-item">
        <label>BSC Vault Address:</label>
        <ng-container *ngIf="!isEditing">
          <span class="address-field">{{
            settings.btcReserveConfig.bscVaultAddr || "Not set"
          }}</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="text"
            formControlName="bscVaultAddr"
            class="form-input address-input"
            placeholder="BSC vault address"
          />
        </div>
      </div>

      <div class="setting-item">
        <label>USDT Token Address:</label>
        <ng-container *ngIf="!isEditing">
          <span class="address-field">{{
            settings.btcReserveConfig.usdtTokenAddr || "Not set"
          }}</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="text"
            formControlName="usdtTokenAddr"
            class="form-input address-input"
            placeholder="USDT token address"
          />
        </div>
      </div>

      <!-- Read-only Status Fields -->
      <div class="setting-item">
        <label>Last Rebalance:</label>
        <span>{{
          settings.btcReserveConfig.lastRebalanceAt
            ? formatDate(settings.btcReserveConfig.lastRebalanceAt)
            : "Never"
        }}</span>
        <small class="read-only-note">Read-only field</small>
      </div>

      <div class="setting-item">
        <label>Last Daily Reset:</label>
        <span>{{
          settings.btcReserveConfig.lastDailyReset
            ? formatDate(settings.btcReserveConfig.lastDailyReset)
            : "Never"
        }}</span>
        <small class="read-only-note">Read-only field</small>
      </div>
    </div>

    <!-- BTC Sweep Configuration Card -->
    <div class="setting-card">
      <h3>
        BTC Sweep Configuration
        <span
          class="status-indicator"
          [class.enabled]="settings.btcSweepConfig.enabled"
        >
          {{ settings.btcSweepConfig.enabled ? "Enabled" : "Disabled" }}
        </span>
      </h3>

      <div class="setting-item">
        <label>Status:</label>
        <ng-container *ngIf="!isEditing">
          <span [class.enabled]="settings.btcSweepConfig.enabled">
            {{ settings.btcSweepConfig.enabled ? "Enabled" : "Disabled" }}
          </span>
        </ng-container>
        <div *ngIf="isEditing" class="toggle-switch">
          <input
            type="checkbox"
            id="btcSweepEnabled"
            formControlName="btcSweepEnabled"
          />
          <label for="btcSweepEnabled"></label>
        </div>
      </div>

      <div class="setting-item">
        <label>Max Sweep USD:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >${{ formatCurrency(settings.btcSweepConfig.maxSweepUsd) }}</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="1000"
            min="0"
            formControlName="btcSweepMaxSweepUsd"
            class="form-input"
          />
          <div class="field-error" *ngIf="getFieldError('btcSweepMaxSweepUsd')">
            {{ getFieldError("btcSweepMaxSweepUsd") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Min Sweep USD:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >${{ formatCurrency(settings.btcSweepConfig.minSweepUsd) }}</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="100"
            min="0"
            formControlName="btcSweepMinSweepUsd"
            class="form-input"
          />
          <div class="field-error" *ngIf="getFieldError('btcSweepMinSweepUsd')">
            {{ getFieldError("btcSweepMinSweepUsd") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Reserve BTC:</label>
        <ng-container *ngIf="!isEditing">
          <span>{{ settings.btcSweepConfig.reserveBtc }} BTC</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="0.00000001"
            min="0"
            formControlName="btcSweepReserveBtc"
            class="form-input"
          />
          <div class="field-error" *ngIf="getFieldError('btcSweepReserveBtc')">
            {{ getFieldError("btcSweepReserveBtc") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Sweep Percentage:</label>
        <ng-container *ngIf="!isEditing">
          <span
            >{{
              settings.btcSweepConfig.sweepPctOfAvail * 100 | number : "1.0-0"
            }}%</span
          >
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="0.01"
            min="0"
            max="1"
            formControlName="btcSweepPctOfAvail"
            class="form-input"
            placeholder="1.0"
          />
          <small class="field-help"
            >Enter as decimal (e.g., 1.0 for 100%)</small
          >
          <div class="field-error" *ngIf="getFieldError('btcSweepPctOfAvail')">
            {{ getFieldError("btcSweepPctOfAvail") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Slippage (BPS):</label>
        <ng-container *ngIf="!isEditing">
          <span>{{ settings.btcSweepConfig.slippageBps }} BPS</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="number"
            step="1"
            min="0"
            max="10000"
            formControlName="btcSweepSlippageBps"
            class="form-input"
          />
          <small class="field-help">1 BPS = 0.01%</small>
          <div class="field-error" *ngIf="getFieldError('btcSweepSlippageBps')">
            {{ getFieldError("btcSweepSlippageBps") }}
          </div>
        </div>
      </div>

      <div class="setting-item">
        <label>Treasury BEP20:</label>
        <ng-container *ngIf="!isEditing">
          <span class="address-field">{{
            settings.btcSweepConfig.treasuryBep20 || "Not set"
          }}</span>
        </ng-container>
        <div *ngIf="isEditing" class="input-wrapper">
          <input
            type="text"
            formControlName="treasuryBep20"
            class="form-input address-input"
            placeholder="BEP20 treasury address"
          />
        </div>
      </div>

      <!-- Read-only Status Fields -->
      <div class="setting-item">
        <label>Last Run:</label>
        <span>{{
          settings.btcSweepConfig.lastRunAt
            ? formatDate(settings.btcSweepConfig.lastRunAt)
            : "Never"
        }}</span>
        <small class="read-only-note">Read-only field</small>
      </div>

      <div class="setting-item">
        <label>Last Inbound Ref:</label>
        <span>{{ settings.btcSweepConfig.lastInboundRef || "None" }}</span>
        <small class="read-only-note">Read-only field</small>
      </div>
    </div>

    <!-- Network Balances Card (Read-only) -->
    <div class="setting-card network-balances-card">
      <h3>Network Balances <small>(Read-only)</small></h3>

      <!-- BTC Balances -->
      <div class="network-section">
        <h4>Bitcoin</h4>
        <div class="setting-item">
          <label>Confirmed Balance:</label>
          <span>{{
            formatBtc(settings.btcBalances.totalConfirmedBalance)
          }}</span>
        </div>
        <div class="setting-item">
          <label>Unconfirmed Balance:</label>
          <span>{{
            formatBtc(settings.btcBalances.totalUnconfirmedBalance)
          }}</span>
        </div>
        <div class="setting-item">
          <label>Total USD Value:</label>
          <span>${{ formatCurrency(settings.btcBalances.totalUsdValue) }}</span>
        </div>
        <div class="setting-item">
          <label>Active Addresses:</label>
          <span>{{ settings.btcBalances.activeAddresses }}</span>
        </div>
        <div class="setting-item">
          <label>Total UTXOs:</label>
          <span>{{ settings.btcBalances.totalUtxos }}</span>
        </div>
        <div class="setting-item">
          <label>Last Updated:</label>
          <span>{{ formatDate(settings.btcBalances.lastBalanceUpdate) }}</span>
        </div>
      </div>

      <!-- BEP20 Balances -->
      <div class="network-section">
        <h4>BSC (BEP20) - {{ settings.bep20Balances.tokenInfo.symbol }}</h4>
        <div class="setting-item">
          <label>Token Balance:</label>
          <span
            >{{ settings.bep20Balances.totalTokenBalance | number : "1.2-6" }}
            {{ settings.bep20Balances.tokenInfo.symbol }}</span
          >
        </div>
        <div class="setting-item">
          <label>BNB Balance:</label>
          <span
            >{{
              formatSmallCurrency(settings.bep20Balances.totalBnbBalance)
            }}
            BNB</span
          >
        </div>
        <div class="setting-item">
          <label>Token USD Value:</label>
          <span
            >${{
              formatCurrency(settings.bep20Balances.totalTokenUsdValue)
            }}</span
          >
        </div>
        <div class="setting-item">
          <label>BNB USD Value:</label>
          <span
            >${{
              formatCurrency(settings.bep20Balances.totalBnbUsdValue)
            }}</span
          >
        </div>
        <div class="setting-item">
          <label>Total USD Value:</label>
          <span
            >${{ formatCurrency(settings.bep20Balances.totalUsdValue) }}</span
          >
        </div>
        <div class="setting-item">
          <label>Active Addresses:</label>
          <span>{{ settings.bep20Balances.activeAddresses }}</span>
        </div>
        <div class="setting-item">
          <label>Last Updated:</label>
          <span>{{
            formatDate(settings.bep20Balances.lastBalanceUpdate)
          }}</span>
        </div>
      </div>

      <!-- Solana Balances -->
      <div class="network-section">
        <h4>Solana</h4>
        <div class="setting-item">
          <label>SOL Balance:</label>
          <span
            >{{
              formatSmallCurrency(settings.solanaBalances.totalSolBalance)
            }}
            SOL</span
          >
        </div>
        <div class="setting-item">
          <label>Total USD Value:</label>
          <span
            >${{ formatCurrency(settings.solanaBalances.totalUsdValue) }}</span
          >
        </div>
        <div class="setting-item">
          <label>Total USDT Value:</label>
          <span
            >${{ formatCurrency(settings.solanaBalances.totalUsdtValue) }}</span
          >
        </div>
        <div class="setting-item">
          <label>Active Addresses:</label>
          <span>{{ settings.solanaBalances.activeAddresses }}</span>
        </div>
        <div class="setting-item">
          <label>Network:</label>
          <span>{{ settings.solanaBalances.network }}</span>
        </div>
        <div class="setting-item">
          <label>Last Updated:</label>
          <span>{{
            formatDate(settings.solanaBalances.lastBalanceUpdate)
          }}</span>
        </div>
      </div>

      <!-- TRC20 Balances -->
      <div class="network-section">
        <h4>
          TRON (TRC-20) -
          {{ settings.trc20Balances.tokenInfo.symbol || "USDT" }}
        </h4>
        <div class="setting-item">
          <label>Token Balance:</label>
          <span
            >{{ settings.trc20Balances.totalTokenBalance | number : "1.2-6" }}
            {{ settings.trc20Balances.tokenInfo.symbol || "USDT" }}</span
          >
        </div>
        <div class="setting-item">
          <label>TRX Balance:</label>
          <span
            >{{
              formatSmallCurrency(settings.trc20Balances.totalTrxBalance)
            }}
            TRX</span
          >
        </div>
        <div class="setting-item">
          <label>Token USD Value:</label>
          <span
            >${{
              formatCurrency(settings.trc20Balances.totalTokenUsdValue)
            }}</span
          >
        </div>
        <div class="setting-item">
          <label>TRX USD Value:</label>
          <span
            >${{
              formatCurrency(settings.trc20Balances.totalTrxUsdValue)
            }}</span
          >
        </div>
        <div class="setting-item">
          <label>Total USD Value:</label>
          <span
            >${{ formatCurrency(settings.trc20Balances.totalUsdValue) }}</span
          >
        </div>
        <div class="setting-item">
          <label>Network:</label>
          <span>{{ settings.trc20Balances.network }}</span>
        </div>
        <div class="setting-item">
          <label>Last Updated:</label>
          <span>{{
            formatDate(settings.trc20Balances.lastBalanceUpdate)
          }}</span>
        </div>
      </div>
    </div>

    <div class="actions" *ngIf="isEditing">
      <button type="button" class="cancel-btn" (click)="toggleEdit()">
        <i class="fas fa-times"></i>
        Cancel
      </button>
      <button
        type="submit"
        class="save-btn"
        (click)="saveSettings()"
        [disabled]="settingsForm.invalid || loading"
      >
        <i class="fas fa-save"></i>
        {{ loading ? "Saving..." : "Save Changes" }}
      </button>
    </div>
  </form>
</div>
